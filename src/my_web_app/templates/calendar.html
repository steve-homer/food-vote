{% extends "base.html" %}

{% block head %}
    {{ super() }}
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet" />
    <style>
        #calendar {
            max-width: 1100px;
            margin: 40px auto;
        }
    </style>
{% endblock %}

{% block content %}
<div class="mdl-grid">
    <div class="mdl-cell mdl-cell--12-col">
        <div id='calendar'></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
                },
                editable: true,
                selectable: true,
                events: '/api/events', // Load events from our API

                // Create a new event
                select: function(info) {
                    var title = prompt('Enter Event Title:');
                    if (title) {
                        var newEvent = {
                            title: title,
                            start: info.startStr,
                            end: info.endStr,
                            allDay: info.allDay
                        };
                        fetch('/api/events', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(newEvent),
                        })
                        .then(response => response.json())
                        .then(data => {
                            calendar.addEvent(data);
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                        });
                    }
                    calendar.unselect();
                },

                // Update an event (drag and drop)
                eventDrop: function(info) {
                    var eventData = {
                        title: info.event.title,
                        start: info.event.startStr,
                        end: info.event.endStr || null,
                        allDay: info.event.allDay,
                    };
                    fetch('/api/events/' + info.event.id, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(eventData),
                    }).catch((error) => {
                        console.error('Error:', error);
                        info.revert();
                    });
                },

                // Update an event (resize)
                eventResize: function(info) {
                    var eventData = {
                        title: info.event.title,
                        start: info.event.startStr,
                        end: info.event.endStr || null,
                        allDay: info.event.allDay,
                    };
                    fetch('/api/events/' + info.event.id, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(eventData),
                    }).catch((error) => {
                        console.error('Error:', error);
                        info.revert();
                    });
                },

                // Delete an event
                eventClick: function(info) {
                    if (confirm("Are you sure you want to delete this event?")) {
                        fetch('/api/events/' + info.event.id, {
                            method: 'DELETE',
                        }).then(() => {
                            info.event.remove();
                        }).catch((error) => {
                            console.error('Error:', error);
                        });
                    }
                }
            });

            calendar.render();
        });
    </script>
{% endblock %} 